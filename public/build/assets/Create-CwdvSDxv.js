import{d as T,u as M,Q as j,H as N,c,a as r,e,h as H,w as n,b as a,R as J,g as m,t as u,o as l,F as v,p as b,f as $,i as f,z as C,S as V,l as K,y as P,x as R,q as k,D as G,r as O}from"./app-CtfNrmtn.js";import{h as F,W as z,I as X,J as Y,_ as Z,K as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-EItJCeZc.js";import{_ as h}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BMNh7sd3.js";import{_ as te}from"./Input.vue_vue_type_script_setup_true_lang-BlOgnfBg.js";import{_ as y}from"./Label.vue_vue_type_script_setup_true_lang-C_kG8D9G.js";import{_ as se}from"./AppPageContent.vue_vue_type_script_setup_true_lang-BdmZ_T2S.js";import{_ as oe,a as re}from"./CardContent.vue_vue_type_script_setup_true_lang-DbCgYpT5.js";import{P as ae}from"./truck-BbJIQY32.js";import{I as ie}from"./info-BCAut_DG.js";import"./index-BPCe6HC_.js";import"./VisuallyHidden-BfTYpA9C.js";import"./useForwardExpose-CPKYoMYP.js";import"./useForwardPropsEmits-DU_LCEXL.js";import"./index-BDqSilVs.js";import"./createLucideIcon-DqD5oH_h.js";const ne={class:"p-4 md:p-6 pb-0"},ue={class:"flex items-center gap-3"},de={class:"text-xl font-semibold"},le={class:"text-sm text-muted-foreground"},ce={class:"p-4 md:p-6 pt-4"},me={class:"space-y-2 md:col-span-2"},pe={class:"flex flex-wrap gap-2"},_e={key:0,class:"text-sm text-destructive"},fe={class:"space-y-2"},he=["value"],ve={key:0,class:"text-sm text-destructive"},ye={class:"space-y-2"},we={class:"flex items-center gap-2"},ge={key:0,class:"text-sm text-destructive"},xe={key:0,class:"space-y-2 md:col-span-2"},be=["value"],ke={key:0,class:"text-sm text-destructive"},qe={class:"flex gap-2 md:col-span-2"},Qe=T({__name:"Create",props:{type:{},warehouses:{},products:{}},setup(B){const w=B,{t:d}=M(),D=[{title:d("nav.stockMovements"),href:F.url()},{title:d("stockMovements.addMovement")}],g=k(()=>M().locale.value==="tr"?"name_tr":"name_en"),q=G(),I=q.props.warehouses??[],U=q.props.products??[],x=w.warehouses??I,S=w.products??U,t=j({warehouse_id:x[0]?.id??"",product_id:"",type:w.type||"in",quantity:"",unit_cost:"",from_warehouse_id:"",notes:""}),_=O([]),W=k(()=>{if(!t.product_id)return null;const i=Number(t.product_id);return S.find(o=>o.id===i)||_.value.find(o=>o.id===i)||null}),L=k(()=>_.value&&_.value.length>0?_.value:S);function Q(){const i=Number(t.quantity)||0;t.quantity=String(i+1)}function A(){const i=Number(t.quantity)||0;i>0&&(t.quantity=String(i-1))}N(W,i=>{if(!i)return;i.unit_price&&(t.unit_cost=String(i.unit_price));const o=i.stockBalances;if(o&&o.length>0)if(t.type==="out"){const s=o.find(p=>Number(p.quantity)>0);s&&s.warehouse?t.warehouse_id=String(s.warehouse.id):o[0]?.warehouse&&(t.warehouse_id=String(o[0].warehouse.id))}else if(t.type==="transfer"){const s=o.find(p=>Number(p.quantity)>0);s&&s.warehouse&&(t.from_warehouse_id=String(s.warehouse.id))}else{const s=o.find(p=>Number(p.quantity)>0);s&&s.warehouse?t.warehouse_id=String(s.warehouse.id):o[0]?.warehouse&&(t.warehouse_id=String(o[0].warehouse.id))}}),N(()=>t.warehouse_id,async i=>{t.product_id="",_.value=[];const o=Number(i);if(o)try{const s=await fetch(`/warehouse/stock-movements/products-by-warehouse?warehouse_id=${o}`);if(s.ok){const p=await s.json();_.value=p}}catch(s){console.error("Failed loading products by warehouse",s)}});function E(){t.post(ee.url(),{onError:i=>{console.error("Form errors:",i)}})}return(i,o)=>(l(),c(v,null,[r(e(H),{title:e(d)("stockMovements.addMovement")},null,8,["title"]),r(Z,{breadcrumbs:D},{default:n(()=>[r(se,null,{header:n(()=>[a("div",ne,[a("div",ue,[a("div",{class:P(`p-2 rounded-lg ${e(t).type==="in"?"bg-emerald-100 dark:bg-emerald-900":"bg-rose-100 dark:bg-rose-900"}`)},[(l(),$(R(e(t).type==="in"?e(X):e(Y)),{class:P(`h-6 w-6 ${e(t).type==="in"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`)},null,8,["class"]))],2),a("div",null,[a("h1",de,u(e(t).type==="in"?e(d)("nav.input"):e(t).type==="out"?e(d)("nav.output"):e(d)("stockMovements.addMovement")),1),a("p",le,u(e(d)("stockMovements.title")),1)])])])]),default:n(()=>[a("div",ce,[r(e(oe),null,{default:n(()=>[r(e(re),{class:"pt-6"},{default:n(()=>[a("form",{onSubmit:J(E,["prevent"]),class:"grid gap-4 md:grid-cols-2"},[a("div",me,[r(e(y),{class:"flex items-center gap-2"},{default:n(()=>[r(e(z),{class:"h-4 w-4 text-muted-foreground"}),m(" "+u(e(d)("stock.warehouse")),1)]),_:1}),a("div",pe,[(l(!0),c(v,null,b(e(x),s=>(l(),$(e(h),{key:s.id,type:"button",variant:e(t).warehouse_id===String(s.id)?"default":"outline",size:"sm",onClick:p=>e(t).warehouse_id=String(s.id),class:"h-auto px-3 py-3 text-xs cursor-pointer"},{default:n(()=>[m(u(s[g.value]),1)]),_:2},1032,["variant","onClick"]))),128))]),e(t).errors.warehouse_id?(l(),c("p",_e,u(e(t).errors.warehouse_id),1)):f("",!0)]),a("div",fe,[r(e(y),{for:"product_id",class:"flex items-center gap-2"},{default:n(()=>[r(e(ae),{class:"h-4 w-4 text-muted-foreground"}),m(" "+u(e(d)("stock.product")),1)]),_:1}),C(a("select",{id:"product_id","onUpdate:modelValue":o[0]||(o[0]=s=>e(t).product_id=s),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[o[3]||(o[3]=a("option",{value:""},"-",-1)),(l(!0),c(v,null,b(L.value,s=>(l(),c("option",{key:s.id,value:s.id},u(s[g.value]),9,he))),128))],512),[[V,e(t).product_id]]),e(t).errors.product_id?(l(),c("p",ve,u(e(t).errors.product_id),1)):f("",!0)]),a("div",ye,[r(e(y),{class:"flex items-center gap-2"},{default:n(()=>[r(e(ie),{class:"h-4 w-4 text-muted-foreground"}),m(" "+u(e(d)("common.quantity")),1)]),_:1}),a("div",we,[r(e(h),{type:"button",variant:"outline",size:"sm",onClick:A,class:"h-10 w-10 p-0"},{default:n(()=>[...o[4]||(o[4]=[m("-",-1)])]),_:1}),r(e(te),{modelValue:e(t).quantity,"onUpdate:modelValue":o[1]||(o[1]=s=>e(t).quantity=s),type:"text",step:"any",required:"",class:"text-center flex-1"},null,8,["modelValue"]),r(e(h),{type:"button",variant:"outline",size:"sm",onClick:Q,class:"h-10 w-10 p-0"},{default:n(()=>[...o[5]||(o[5]=[m("+",-1)])]),_:1})]),e(t).errors.quantity?(l(),c("p",ge,u(e(t).errors.quantity),1)):f("",!0)]),e(t).type==="transfer"?(l(),c("div",xe,[r(e(y),{for:"from_warehouse_id",class:"flex items-center gap-2"},{default:n(()=>[r(e(z),{class:"h-4 w-4 text-muted-foreground"}),m(" "+u(e(d)("stockMovements.fromWarehouse")),1)]),_:1}),C(a("select",{id:"from_warehouse_id","onUpdate:modelValue":o[2]||(o[2]=s=>e(t).from_warehouse_id=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[o[6]||(o[6]=a("option",{value:""},"-",-1)),(l(!0),c(v,null,b(e(x),s=>(l(),c("option",{key:s.id,value:s.id},u(s[g.value]),9,be))),128))],512),[[V,e(t).from_warehouse_id]]),e(t).errors.from_warehouse_id?(l(),c("p",ke,u(e(t).errors.from_warehouse_id),1)):f("",!0)])):f("",!0),a("div",qe,[r(e(h),{type:"submit",disabled:e(t).processing},{default:n(()=>[m(u(e(d)("common.save")),1)]),_:1},8,["disabled"]),r(e(K),{href:e(F).url()},{default:n(()=>[r(e(h),{type:"button",variant:"outline"},{default:n(()=>[m(u(e(d)("common.cancel")),1)]),_:1})]),_:1},8,["href"])])],32)]),_:1})]),_:1})])]),_:1})]),_:1})],64))}});export{Qe as default};
