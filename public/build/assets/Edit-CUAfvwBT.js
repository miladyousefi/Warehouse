import{d as T,u as M,Q as j,H as N,c as m,a as r,e,h as H,w as n,b as i,R as J,g as p,t as u,o as c,F as y,p as S,f as C,i as h,z as V,S as P,l as R,y as F,x as G,q,D as K,r as O}from"./app-CtfNrmtn.js";import{W as z,I as X,J as Y,_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-EItJCeZc.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BMNh7sd3.js";import{_ as ee}from"./Input.vue_vue_type_script_setup_true_lang-BlOgnfBg.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-C_kG8D9G.js";import{_ as te}from"./AppPageContent.vue_vue_type_script_setup_true_lang-BdmZ_T2S.js";import{_ as se,a as oe}from"./CardContent.vue_vue_type_script_setup_true_lang-DbCgYpT5.js";import{P as re}from"./truck-BbJIQY32.js";import{I as ae}from"./info-BCAut_DG.js";import"./index-BPCe6HC_.js";import"./VisuallyHidden-BfTYpA9C.js";import"./useForwardExpose-CPKYoMYP.js";import"./useForwardPropsEmits-DU_LCEXL.js";import"./index-BDqSilVs.js";import"./createLucideIcon-DqD5oH_h.js";const ie={class:"p-4 md:p-6 pb-0"},ne={class:"flex items-center gap-3"},ue={class:"text-xl font-semibold"},de={class:"text-sm text-muted-foreground"},le={class:"p-4 md:p-6 pt-4"},ce={class:"space-y-2 md:col-span-2"},me={class:"flex flex-wrap gap-2"},pe={key:0,class:"text-sm text-destructive"},_e={class:"space-y-2"},fe=["value"],he={key:0,class:"text-sm text-destructive"},ve={class:"space-y-2"},we={class:"flex items-center gap-2"},ye={key:0,class:"text-sm text-destructive"},ge={key:0,class:"space-y-2 md:col-span-2"},xe=["value"],be={key:0,class:"text-sm text-destructive"},ke={class:"flex gap-2 md:col-span-2"},Ee=T({__name:"Edit",props:{movement:{},warehouses:{},products:{}},setup(B){const x=B,{t:d}=M(),D=[{title:d("nav.stockMovements"),href:"/warehouse/stock-movements"},{title:d("stockMovements.editMovement")}],b=q(()=>M().locale.value==="tr"?"name_tr":"name_en"),k=K(),I=k.props.warehouses??[],U=k.props.products??[],w=x.warehouses??I,$=x.products??U,l=x.movement||k.props.movement,t=j({warehouse_id:l?.warehouse_id?String(l.warehouse_id):w[0]?.id?String(w[0].id):"",product_id:l?.product_id?String(l.product_id):"",type:l?.type??"in",quantity:l?.quantity?String(l.quantity):"",unit_cost:l?.unit_cost?String(l.unit_cost):"",from_warehouse_id:l?.from_warehouse_id?String(l.from_warehouse_id):"",notes:l?.notes??""}),f=O([]),W=q(()=>{if(!t.product_id)return null;const a=Number(t.product_id);return $.find(o=>o.id===a)||f.value.find(o=>o.id===a)||null}),E=q(()=>f.value&&f.value.length>0?f.value:$);function L(){const a=Number(t.quantity)||0;t.quantity=String(a+1)}function Q(){const a=Number(t.quantity)||0;a>0&&(t.quantity=String(a-1))}N(W,a=>{if(!a)return;a.unit_price&&(t.unit_cost=String(a.unit_price));const o=a.stockBalances;if(o&&o.length>0)if(t.type==="out"){const s=o.find(_=>Number(_.quantity)>0);s&&s.warehouse?t.warehouse_id=String(s.warehouse.id):o[0]?.warehouse&&(t.warehouse_id=String(o[0].warehouse.id))}else if(t.type==="transfer"){const s=o.find(_=>Number(_.quantity)>0);s&&s.warehouse&&(t.from_warehouse_id=String(s.warehouse.id))}else{const s=o.find(_=>Number(_.quantity)>0);s&&s.warehouse?t.warehouse_id=String(s.warehouse.id):o[0]?.warehouse&&(t.warehouse_id=String(o[0].warehouse.id))}}),N(()=>t.warehouse_id,async a=>{t.product_id="",f.value=[];const o=Number(a);if(o)try{const s=await fetch(`/warehouse/stock-movements/products-by-warehouse?warehouse_id=${o}`);if(s.ok){const _=await s.json();f.value=_}}catch(s){console.error("Failed loading products by warehouse",s)}});function A(){const a=l?.id;a&&t.patch(`/warehouse/stock-movements/${a}`,{onError:o=>{console.error("Form errors:",o)}})}return(a,o)=>(c(),m(y,null,[r(e(H),{title:e(d)("stockMovements.editMovement")},null,8,["title"]),r(Z,{breadcrumbs:D},{default:n(()=>[r(te,null,{header:n(()=>[i("div",ie,[i("div",ne,[i("div",{class:F(`p-2 rounded-lg ${e(t).type==="in"?"bg-emerald-100 dark:bg-emerald-900":"bg-rose-100 dark:bg-rose-900"}`)},[(c(),C(G(e(t).type==="in"?e(X):e(Y)),{class:F(`h-6 w-6 ${e(t).type==="in"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`)},null,8,["class"]))],2),i("div",null,[i("h1",ue,u(e(t).type==="in"?e(d)("nav.input"):e(t).type==="out"?e(d)("nav.output"):e(d)("stockMovements.editMovement")),1),i("p",de,u(e(d)("stockMovements.title")),1)])])])]),default:n(()=>[i("div",le,[r(e(se),null,{default:n(()=>[r(e(oe),{class:"pt-6"},{default:n(()=>[i("form",{onSubmit:J(A,["prevent"]),class:"grid gap-4 md:grid-cols-2"},[i("div",ce,[r(e(g),{class:"flex items-center gap-2"},{default:n(()=>[r(e(z),{class:"h-4 w-4 text-muted-foreground"}),p(" "+u(e(d)("stock.warehouse")),1)]),_:1}),i("div",me,[(c(!0),m(y,null,S(e(w),s=>(c(),C(e(v),{key:s.id,type:"button",variant:e(t).warehouse_id===String(s.id)?"default":"outline",size:"sm",onClick:_=>e(t).warehouse_id=String(s.id),class:"h-auto px-3 py-1 text-xs"},{default:n(()=>[p(u(s[b.value]),1)]),_:2},1032,["variant","onClick"]))),128))]),e(t).errors.warehouse_id?(c(),m("p",pe,u(e(t).errors.warehouse_id),1)):h("",!0)]),i("div",_e,[r(e(g),{for:"product_id",class:"flex items-center gap-2"},{default:n(()=>[r(e(re),{class:"h-4 w-4 text-muted-foreground"}),p(" "+u(e(d)("stock.product")),1)]),_:1}),V(i("select",{id:"product_id","onUpdate:modelValue":o[0]||(o[0]=s=>e(t).product_id=s),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[o[3]||(o[3]=i("option",{value:""},"-",-1)),(c(!0),m(y,null,S(E.value,s=>(c(),m("option",{key:s.id,value:s.id},u(s[b.value]),9,fe))),128))],512),[[P,e(t).product_id]]),e(t).errors.product_id?(c(),m("p",he,u(e(t).errors.product_id),1)):h("",!0)]),i("div",ve,[r(e(g),{class:"flex items-center gap-2"},{default:n(()=>[r(e(ae),{class:"h-4 w-4 text-muted-foreground"}),p(" "+u(e(d)("common.quantity")),1)]),_:1}),i("div",we,[r(e(v),{type:"button",variant:"outline",size:"sm",onClick:Q,class:"h-10 w-10 p-0"},{default:n(()=>[...o[4]||(o[4]=[p("-",-1)])]),_:1}),r(e(ee),{modelValue:e(t).quantity,"onUpdate:modelValue":o[1]||(o[1]=s=>e(t).quantity=s),type:"number",step:"any",required:"",class:"text-center flex-1"},null,8,["modelValue"]),r(e(v),{type:"button",variant:"outline",size:"sm",onClick:L,class:"h-10 w-10 p-0"},{default:n(()=>[...o[5]||(o[5]=[p("+",-1)])]),_:1})]),e(t).errors.quantity?(c(),m("p",ye,u(e(t).errors.quantity),1)):h("",!0)]),e(t).type==="transfer"?(c(),m("div",ge,[r(e(g),{for:"from_warehouse_id",class:"flex items-center gap-2"},{default:n(()=>[r(e(z),{class:"h-4 w-4 text-muted-foreground"}),p(" "+u(e(d)("stockMovements.fromWarehouse")),1)]),_:1}),V(i("select",{id:"from_warehouse_id","onUpdate:modelValue":o[2]||(o[2]=s=>e(t).from_warehouse_id=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[o[6]||(o[6]=i("option",{value:""},"-",-1)),(c(!0),m(y,null,S(e(w),s=>(c(),m("option",{key:s.id,value:s.id},u(s[b.value]),9,xe))),128))],512),[[P,e(t).from_warehouse_id]]),e(t).errors.from_warehouse_id?(c(),m("p",be,u(e(t).errors.from_warehouse_id),1)):h("",!0)])):h("",!0),i("div",ke,[r(e(v),{type:"submit",disabled:e(t).processing},{default:n(()=>[p(u(e(d)("common.save")),1)]),_:1},8,["disabled"]),r(e(R),{href:"/warehouse/stock-movements"},{default:n(()=>[r(e(v),{type:"button",variant:"outline"},{default:n(()=>[p(u(e(d)("common.cancel")),1)]),_:1})]),_:1})])],32)]),_:1})]),_:1})])]),_:1})]),_:1})],64))}});export{Ee as default};
